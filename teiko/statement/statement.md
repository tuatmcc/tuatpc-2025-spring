# 抵抗器

## 問題文

抵抗器が接続された回路図が図 1 に示す構文規則によって与えられます。

<div align="center">

![回路図](https://hackmd.io/_uploads/SJCL7xo5ke.png)

図 1 : 構文規則

構文規則について追加の説明を以下に示します。

</div>

1. 終端記号は `o`, `-`、`^v^v^v`、`+`、`|`、およびスペース文字 ` ` からなる。
2. 非終端記号および終端記号は高さと幅を持つ $2$ 次元の文字領域である。
3. `<回路>` は回路図全体を表す。`<始点>` と `<直列抵抗>` は `<始点>` の右端と `<直列抵抗>` の最も左上の位置を繋げる。`<直列抵抗>` と `<終点>` は `<直列抵抗>` の最も右上の位置と `<終点>` の左端を繋げる。`<回路>` の高さは各置き換え後の記号の高さの最大値であり、幅は各置き換え後の記号の幅の和である。
4. `<直列抵抗>` は、`<並列抵抗>` であるか、`<並列抵抗>` と `<直列抵抗>` を終端文字 `---` で繋げたものである。`<並列抵抗>` と `---` は `<並列抵抗>` の最も右上の位置と `---` の左端を繋げる。`---` と `<直列抵抗>` は `---` の右端と `<直列抵抗>` の最も左上の位置を繋げる。 `<直列抵抗>` の高さは各置き換え後の記号の高さの最大値であり、幅は各置き換え後の記号の幅の和である。
5. `<並列抵抗>` は `<抵抗>` であるか、$2$ つ以上の `<直列抵抗>` を `+`、`|`、`-` を使って並列に繋げたものである。`<抵抗>` に置き換えられる場合の高さと幅は `<抵抗>` の高さと幅に一致する。`<直列抵抗>` に置き換えられる場合について、
   - `<並列抵抗>` から置き換えられる `<直列抵抗>` の数を $n$、各 `<直列抵抗>` の高さと幅をそれぞれ $H_i, W_i$ とする。また、幅の最大値を $W_\mathrm{max}$ とする。
   - `+---` の右端と `<直列抵抗>` の最も左上の位置をそれぞれ繋げる。次に `<直列抵抗>` の最も右上の位置と `---` の左端をそれぞれ繋げる。さらに、右側の `---`　の右端からハイフンを延長するように $(W_\mathrm{max} - W_i)$ 個の `-` を繋げる。最後に末尾に `+` を繋げる。
   - $1$ 以上 $n - 1$ 以下の $i$ について、$i$ 個目の `<直列抵抗>` と $(i + 1)$ 個目の `<直列抵抗>` の間の行について、$i$ 個目の `<直列抵抗>` に接続された両端の `+` の直下に `|` を $H_i$ 個繋げることで、各 `<直列抵抗>` を接続する。
   - `<並列抵抗>` の高さは $\sum_{i=1}^{n} H_i + n - 1$ であり、幅は $W_\mathrm{max} + 8$ である。
   - 具体例を図 2 に示す。入力例も参考にせよ。
6. 全ての終端記号の高さは $1$ であり、幅は文字列の長さである。
7. 全ての非終端記号について、その $2$ 次元領域内で終端記号が設定されていない位置の文字はスペース文字 ` ` で置き換える。
8. 7 の置き換えを全て行った後、`<回路>` を表す文字領域の各行について、末尾の文字がスペース文字 ` ` である限り、末尾の文字を削除する。

<div align="center">

![並列(1)](https://hackmd.io/_uploads/B1AUmeoqyl.png)

図 2 : `<並列抵抗>` の置き換え例

</div>

さて、`<回路>` が示す始点と終点の間の合成抵抗は `<回路>` が生成する `<直列抵抗>` の合成抵抗です。

`<直列抵抗>` の合成抵抗は `<並列抵抗>` のみが生成される場合は、`<並列抵抗>` の合成抵抗です。そうでないとき、生成される `<並列抵抗>` と `<直列抵抗>` の合成抵抗の値をそれぞれ $R_1, R_2$ とすると、合成抵抗は $R_1 + R_2$ となります。

`<並列抵抗>` の合成抵抗は、 `<抵抗>` のみが生成される場合の合成抵抗は $1$ です。そうでないとき、生成される $n$ 個の直列抵抗の合成抵抗の値をそれぞれ $R_1, R_2, \dots, R_n$ とすると、合成抵抗は $\displaystyle \frac{1}{\frac{1}{R_1} + \frac{1}{R_2} + \cdots + \frac{1}{R_n}}$ です。


`<回路>` に従う $N$ 行からなる文字列 $S$ が与えられます。`<回路>` $S$ が示す始点と終点の間の合成抵抗を $\mathrm{mod}\ 998244353$ で求めてください。

## 注記

### $\mathrm{mod}\ 998244353$ で求めるとは

求める合成抵抗は必ず有理数となることが証明できます。またこの問題の制約下では、その値を互いに素な $2$ つの整数 $P, Q$ を用いて $\frac{P}{Q}$ と表したとき、$R \times Q \equiv P \pmod{998244353}$ かつ $0 \leq R < 998244353$ を満たす整数 $R$ がただ一つ存在することが証明できます。この $R$ を求めてください。


## 制約

- $N$ は整数
- $S$ は図 1 の `<回路>` に従う
- $i$ 行目の文字列の長さを $|S_i|$ として、$N \times \underset{1 \le i \le N}{\max} |S_i| \leq {@constraints.S_MAX}$

### 部分点

この問題に部分点は存在しません。

## 入力

入力は以下の形式で標準入力から与えられます。

<div class="code-math">

$N$
$S_1$
$\vdots$
$S_N$
    
</div>

## 出力

答えを標準出力に出力してください。

{@samples.all}
