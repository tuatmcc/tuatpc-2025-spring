# 抵抗器

## 問題文

抵抗器が接続された回路図が図 1 に示す BNF 記法のような記法で記述された文法 $G$ によって与えられます。

<div align="center">

![回路図](https://hackmd.io/_uploads/SJCL7xo5ke.png)

図 1 : 構文規則

</div>

文法について追加の説明を以下に示します。

1. 終端記号は `o`, `-`、`^v^v^v`、`+`、`|`、および空白文字（ASCII 32） ` `  からなる。
2. 非終端記号は `<回路>`, `<直列抵抗>`, `<並列抵抗>`, `<始点>`, `<終点>`, `<抵抗>` からなる。
3. 非終端記号および終端記号は高さと幅を持つ $2$ 次元の文字領域である。
4. ある非終端記号に含まれる終端記号はその生成規則によって書き換えられることはない。また、各 $2$ 次元の文字領域は重なることなく配置される。
5. 開始記号は `<回路>` である。 開始記号に図 1 に示す置換規則を非終端記号が無くなるまで適用する。
6. `<回路>` は`<始点>`, `<直列回路>`, `<終点>` をこの順に左から連結したものに置換される。`<回路>` の高さは置換後の各記号の高さの最大値であり、幅は置換後の各記号の幅の和である。
7. `<直列抵抗>` は、`<並列抵抗>` に置換されるか、`<並列抵抗>`, `---`, `<直列抵抗>` をこの順に左から連結したものに置換される。`<直列抵抗>` の高さは置換後の各記号の高さの最大値であり、幅は置換後の各記号の幅の和である。
8. `<並列抵抗>` は `<抵抗>` に置換されるか、$2$ つ以上の `<直列抵抗>` を `+`、`|`、`-` を使って上下に連結したものに置換される。前者の場合、`<並列抵抗>` の高さと幅は `<抵抗>` の高さと幅に一致する。後者の場合の置換・連結方法と高さと幅は以下のようになる。
   - `<並列抵抗>` から置換される `<直列抵抗>` の数を $n$、上から $i$ 番目の `<直列抵抗>` の高さと幅をそれぞれ $H_i, W_i$ とする。また、幅の最大値を $\underset{1 \leq i \leq n}{\max}W_i$ とする。
   - 上から $i$ 番目の `<直列抵抗>` $\alpha_i$ について、`+---`, $\alpha_i$, `---` をこの順に連結する。さらに、右側の `---` の右端からハイフンを延長するように $(\underset{1 \leq i \leq n}{\max}W_i - W_i)$ 個の `-` を連結する。最後に末尾に `+` を繋げる。
   - $1$ 以上 $n - 1$ 以下の $i$ について、上から $i$ 番目の `<直列抵抗>` と上から $(i + 1)$ 番目の `<直列抵抗>` の間の行について、上から $i$ 番目の `<直列抵抗>` に接続された両端の `+` の直下に `|` を $H_i$ 個連結させる。
   - この `<並列抵抗>` の高さは $\sum_{i=1}^{n} H_i + n - 1$ であり、幅は $\underset{1 \leq i \leq n}{\max}W_i + 8$ である。
   - 具体例を図 2 に示す。入力例も参考にせよ。
9. 全ての終端記号の高さは $1$ であり、幅は文字列の長さである。
10. 全ての非終端記号について、その高さと幅の $2$ 次元領域内で終端記号が設定されていない位置の文字は空白文字 ` ` (ASCII 32) とする。ただし、`<回路>` ついては、末尾の文字が空白文字 (ASCII 32) ` ` は全て削除する。

<div align="center">

![並列(1)](https://hackmd.io/_uploads/B1AUmeoqyl.png)

図 2 : `<並列抵抗>` の置換例

</div>

さて、文法 $G$ によって生成される文字列が示す**始点と終点の間の合成抵抗**とは、開始記号 `<回路>` が生成する `<直列抵抗>` の合成抵抗です。

`<直列抵抗>` の合成抵抗は `<並列抵抗>` のみに置き換えられる場合は、`<並列抵抗>` の合成抵抗です。そうでないとき、`<直列抵抗>` から置換された `<並列抵抗>` と `<直列抵抗>` の合成抵抗の値をそれぞれ $R_1, R_2$ とすると、合成抵抗は $R_1 + R_2$ となります。

`<並列抵抗>` の合成抵抗は、 `<抵抗>` のみに置き換えられる場合の合成抵抗は $1$ です。そうでないとき、`<直列抵抗>` から置換された $n$ 個の直列抵抗の合成抵抗の値をそれぞれ $R_1, R_2, \dots, R_n$ とすると、合成抵抗は $\displaystyle \frac{1}{\frac{1}{R_1} + \frac{1}{R_2} + \cdots + \frac{1}{R_n}}$ です。


文法 $G$ に従って $N$ 行からなる文字列 $S$ が与えられます。$S$ が示す始点と終点の間の合成抵抗を $\mathrm{mod}\ 998244353$ で求めてください。

## 注記

### $\mathrm{mod}\ 998244353$ で求めるとは

求める合成抵抗は必ず有理数になることが証明できます。 
また、この問題の制約により、その値を既約分数 $\frac{Q}{P}$ で表した時、$Q \not\equiv 0 \pmod{998244353}$ であることが保証されます。 よって、 $R \times Q \equiv P \pmod{998244353},0 \leq R < 998244353$ を満たす整数 $R$ が一意に定まります。 この $R$ を答えてください。

## 制約

- $N$ は整数
- $S$ は文法 $G$ に従って得られる文字列
- $i$ 行目の文字列の長さを $|S_i|$ として、$N \times \underset{1 \le i \le N}{\max} |S_i| \leq {@constraints.S_MAX}$
- $S$ の示す始点と終点の間の合成抵抗を既約分数 $\frac{Q}{P}$ で表した時、$Q \not\equiv 0 \pmod{998244353}$ である

### 部分点

この問題に部分点は存在しません。

## 入力

入力は以下の形式で標準入力から与えられます。

<div class="code-math">

$N$
$S_1$
$\vdots$
$S_N$
    
</div>

## 出力

答えを標準出力に出力してください。

{@samples.all}
